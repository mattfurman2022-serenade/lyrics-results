<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Personalized Lyrics</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 40px;
    }
    pre {
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 16px;
    }
  </style>
</head>
<body>

<h1>Your Personalized Lyrics</h1>
<p id="status">ðŸŽµ Generating your songâ€¦</p>
<pre id="lyrics"></pre>

<script>
  alert("JS IS RUNNING");
(async () => {
  const formData = new FormData(document.forms[0] || window.opener?.document.forms[0]);
  const params = new URLSearchParams(window.location.search);

  const person = params.get("person");
  const memory = params.get("memory");
  const love = params.get("love");
  const message = params.get("message");

  const prompt = `
Write a romantic song with these details:
Person: ${person}
Memory: ${memory}
What I love: ${love}
Message: ${message}
Include the person's name naturally in the lyrics.
`;

  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "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"
      },
      body: JSON.stringify({
        model: "gpt-4.1-mini",
        messages: [
          { role: "system", content: "You are a professional songwriter." },
          { role: "user", content: prompt }
        ],
        temperature: 0.8
      })
    });

    const data = await response.json();
    document.getElementById("status").style.display = "none";
    document.getElementById("lyrics").innerText =
      data.choices[0].message.content;

  } catch (err) {
    document.getElementById("status").innerText = "Lyrics failed to load.";
    console.error(err);
  }
})();
</script>

</body>
</html>
